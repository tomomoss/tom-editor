var e={610:(e,t,i)=>{i.d(t,{Z:()=>o});var s=i(645),r=i.n(s)()((function(e){return e[1]}));r.push([e.id,'@keyframes tom-editor-caret-blinking{0%{border-left-color:#333}50%{border-left-color:transparent}}.tom-editor__caret{background:transparent;border:none;border-left:solid .15rem;display:none;height:1.25rem;outline:none;overflow:hidden;padding:0;pointer-events:none;position:absolute;resize:none;width:0}.tom-editor__caret--active{animation:tom-editor-caret-blinking 1.25s steps(1) infinite both}.tom-editor__caret--focus{display:inline-block}.tom-editor__decoration-underline{border-bottom:solid .1rem #eee;height:1.25rem;pointer-events:none;position:absolute;display:none}.tom-editor__decoration-underline--active{display:block}.tom-editor__editor{background:#fff;bottom:0;display:flex;font:normal 1rem/1.25rem Consolas,"Courier New",monospace;justify-content:space-between;left:0;overflow:hidden;position:absolute;right:0;top:0;white-space:pre;width:100%}.tom-editor__editor-wrapper{height:100%;position:relative;width:100%}.tom-editor__horizontal-scrollbar-area{bottom:0;display:none;height:1rem;position:absolute}.tom-editor__horizontal-scrollbar-area--active{display:block}.tom-editor__horizontal-scrollbar-area__horizontal-scrollbar{background:#eee;height:100%;position:absolute}.tom-editor__horizontal-scrollbar-area__horizontal-scrollbar:hover{background:#ddd}.tom-editor__horizontal-scrollbar-area__horizontal-scrollbar:active{background:#ccc}.tom-editor__line-number-area{background:#fff;cursor:default;flex:0 0;overflow:hidden;text-align:right;z-index:1}.tom-editor__line-number-area__line-number{color:#ccc;padding:0 2rem 0 0}.tom-editor__line-number-area__line-number::selection{background:transparent}.tom-editor__line-number-area__line-number:not(.tom-editor__line-number-area__line-number--focus,.tom-editor__line-number-area__line-number--read-only):hover{color:#999}.tom-editor__line-number-area__line-number:last-of-type{height:100%}.tom-editor__line-number-area__line-number--focus{color:#666}.tom-editor__text-area{background:#fff;cursor:text;flex:1 1 auto;overflow:hidden}.tom-editor__text-area__character{display:inline-block;vertical-align:top}.tom-editor__text-area__character::selection{background:transparent}.tom-editor__text-area__character--eol{margin:0 3rem 0 0}.tom-editor__text-area__character--select{background:#def}.tom-editor__text-area__text-line{height:1.25rem}.tom-editor__text-area__text-line:last-of-type{height:100%}.tom-editor__virtical-scrollbar-area{background:#fff;border-left:.1rem solid #eee;flex:0 0 1rem;position:relative;width:1rem;z-index:1}.tom-editor__virtical-scrollbar-area__virtical-scrollbar{background:#eee;display:none;position:absolute;width:100%}.tom-editor__virtical-scrollbar-area__virtical-scrollbar:hover{background:#ddd}.tom-editor__virtical-scrollbar-area__virtical-scrollbar:active{background:#ccc}.tom-editor__virtical-scrollbar-area__virtical-scrollbar--active{display:block}',""]);const o=r},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i=e(t);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i})).join("")},t.i=function(e,i,s){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(s)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(r[a]=!0)}for(var n=0;n<e.length;n++){var l=[].concat(e[n]);s&&r[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},379:e=>{var t=[];function i(e){for(var i=-1,s=0;s<t.length;s++)if(t[s].identifier===e){i=s;break}return i}function s(e,s){for(var o={},a=[],n=0;n<e.length;n++){var l=e[n],c=s.base?l[0]+s.base:l[0],d=o[c]||0,h="".concat(c," ").concat(d);o[c]=d+1;var u=i(h),m={css:l[1],media:l[2],sourceMap:l[3]};-1!==u?(t[u].references++,t[u].updater(m)):t.push({identifier:h,updater:r(m,s),references:1}),a.push(h)}return a}function r(e,t){var i=t.domAPI(t);return i.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i.update(e=t)}else i.remove()}}e.exports=function(e,r){var o=s(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var n=i(o[a]);t[n].references--}for(var l=s(e,r),c=0;c<o.length;c++){var d=i(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},569:e=>{var t={};e.exports=function(e,i){var s=function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},565:(e,t,i)=>{e.exports=function(e){var t=i.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(i){!function(e,t,i){var s=i.css,r=i.media,o=i.sourceMap;r?e.setAttribute("media",r):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(s,e)}(t,e,i)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function i(s){var r=t[s];if(void 0!==r)return r.exports;var o=t[s]={id:s,exports:{}};return e[s](o,o.exports,i),o.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};(()=>{i.d(s,{r:()=>p});var e=i(379),t=i.n(e),r=i(795),o=i.n(r),a=i(569),n=i.n(a),l=i(565),c=i.n(l),d=i(216),h=i.n(d),u=i(589),m=i.n(u),f=i(610),v={};v.styleTagTransform=m(),v.setAttributes=c(),v.insert=n().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=h(),t()(f.Z,v),f.Z&&f.Z.locals&&f.Z.locals;const p=class{constructor(e,t,...i){if(void 0===e)throw new TypeError("第1引数が指定されていません。");if(!e instanceof Element)throw new TypeError("第1引数がElement型ではありません。");if(void 0!==t){if("object"!=typeof t)throw new TypeError("第2引数がObject型ではありません。");for(const e in t)if("readonly"!==e){if("readonly"!==e)throw new Error(`キー「${e}」はキー名として許可されていません。`)}else if("boolean"!=typeof t.readonly)throw new Error("キー「readonly」には真偽値を指定してください。")}if(i.length)throw new TypeError("引数の数が不正です。");let s;Object.seal(this),e.textContent="",s=void 0!==t&&t.readonly;const r=this.createEditorWrapper();e.appendChild(r),this.editor=this.createEditor(),r.appendChild(this.editor),this.lineNumberArea=new class{constructor(e,t){Object.seal(this),this.editor=e,this.lineNumberArea=this.createLineNumberArea(t),this.editor.appendChild(this.lineNumberArea),this.appendLineNumber();const i=document.createElement("span");i.textContent="0",i.style.display="inline-block",this.lineNumberArea.appendChild(i);const s=i.clientWidth;i.remove();const r=parseFloat(getComputedStyle(this.lineNumbers[0]).paddingRight);this.lineNumberArea.style.flexBasis=`${4.5*s+r}px`,this.setEventListeners(t)}CSSClass={lineNumber:{element:"tom-editor__line-number-area__line-number",modifier:{focus:"tom-editor__line-number-area__line-number--focus",readOnly:"tom-editor__line-number-area__line-number--read-only"}},lineNumberArea:{element:"tom-editor__line-number-area",modifier:{readOnly:"tom-editor__line-number-area--read-only"}}};editor;focusedLineNumberIndex=null;lineNumberArea;lineNumbers=[];appendLineNumber=()=>{const e=this.createLineNumber();this.lineNumbers.push(e),this.lineNumberArea.appendChild(e)};changeFocusLineNumber=e=>{if(null===e){if(null===this.focusedLineNumberIndex)return;return this.lineNumbers[this.focusedLineNumberIndex].classList.contains(this.CSSClass.lineNumber.modifier.focus)&&this.lineNumbers[this.focusedLineNumberIndex].classList.remove(this.CSSClass.lineNumber.modifier.focus),void(this.focusedLineNumberIndex=null)}e!==this.focusedLineNumberIndex&&(null!==this.focusedLineNumberIndex&&this.lineNumbers[this.focusedLineNumberIndex]&&this.lineNumbers[this.focusedLineNumberIndex].classList.remove(this.CSSClass.lineNumber.modifier.focus),this.focusedLineNumberIndex=e,this.lineNumbers[this.focusedLineNumberIndex].classList.add(this.CSSClass.lineNumber.modifier.focus))};createLineNumber=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.lineNumber.element),this.lineNumberArea.classList.contains(this.CSSClass.lineNumberArea.modifier.readOnly)&&e.classList.add(this.CSSClass.lineNumber.modifier.readOnly),e.textContent=this.lineNumbers.length+1,e};createLineNumberArea=e=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.lineNumberArea.element),e&&t.classList.add(this.CSSClass.lineNumberArea.modifier.readOnly),t};removeLineNumber=()=>{this.lineNumbers.pop().remove()};setEventListeners=e=>{if(this.editor.addEventListener("custom-changeNumberOfTextLines",(e=>{for(;e.detail.length>this.lineNumbers.length;)this.appendLineNumber();for(;e.detail.length<this.lineNumbers.length;)this.removeLineNumber()})),this.editor.addEventListener("custom-changeTextAreaScrollTop",(e=>{this.lineNumberArea.scrollTop=e.detail.scrollTop})),!e){let e=null;this.lineNumberArea.addEventListener("mousedown",(t=>{e=this.lineNumbers.findIndex((e=>e===t.target)),this.editor.dispatchEvent(new CustomEvent("custom-mousedonwLineNumber",{detail:{index:e}}))})),this.editor.addEventListener("custom-mousemove",(t=>{if(null===e)return;const i=this.lineNumbers.findIndex((e=>e===t.detail.target));i!==e&&(e=i,this.editor.dispatchEvent(new CustomEvent("custom-dragLineNumber",{detail:{index:e}})))})),this.editor.addEventListener("custom-mouseup",(()=>{e=null})),this.editor.addEventListener("custom-changeFocusedRowIndex",(e=>{this.changeFocusLineNumber(e.detail.index)}))}}}(this.editor,s),this.textArea=new class{constructor(e,t){Object.seal(this),this.editor=e,this.textArea=this.createTextArea(t),this.editor.appendChild(this.textArea);const i=this.createTextLine();this.textLines.push(i),this.textArea.appendChild(i),this.characters.push([]);const s=this.createEOL();this.characters[0].push(s),i.appendChild(s),this.lastDispatchedEventValue={index:this.focusedRowIndex,length:this.textLines.length,scrollLeft:this.textArea.scrollLeft,scrollTop:this.textArea.scrollTop,selecingRange:Boolean(this.selectionRange.length),viewportHeightRatio:this.textArea.clientHeight/this.textArea.scrollHeight,viewportWidthRatio:this.textArea.clientWidth/this.textArea.scrollWidth},this.saveHistory(),this.setEventListeners(t)}CSSClass={character:{element:"tom-editor__text-area__character",modifier:{EOL:"tom-editor__text-area__character--eol"}},textArea:{element:"tom-editor__text-area"},textLine:{element:"tom-editor__text-area__text-line"}};characters=[];editor;focusedColumnIndex=null;focusedRowIndex=null;history;lastDispatchedEventValue;selectionRange=[];textArea;textLines=[];appendCharacter=e=>{const t=this.createCharacter(e);this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,0,t),this.focusedColumnIndex+=1,this.getFocusedCharacter().before(t)};appendTextLine=e=>{const t=this.createTextLine();this.textLines.splice(this.focusedRowIndex+1,0,t),this.characters.splice(this.focusedRowIndex+1,0,[]);const i=this.createEOL();e.push(i);for(const i of e)t.appendChild(i),this.characters[this.focusedRowIndex+1].push(i);this.textLines[this.focusedRowIndex].after(t),this.focusedRowIndex+=1,this.focusedColumnIndex=0};convertSelectedRangeIntoText=e=>{let t="";if(this.selectionRange.length)for(const e of this.selectionRange)for(const i of e){if(i.classList.contains("tom-editor__text-area__character--eol")){t+="\n";break}t+=i.textContent}else t="";return e&&this.removeCharactersInSelectionRange(),t};createCharacter=e=>{const t=document.createElement("span");return t.classList.add(this.CSSClass.character.element),t.textContent=e,t};createEOL=()=>{const e=document.createElement("span");return e.classList.add(this.CSSClass.character.element,this.CSSClass.character.modifier.EOL),e.textContent=" ",e};createTextArea=e=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.textArea.element),e&&(t.style.cursor="default"),t};createTextLine=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.textLine.element),e};differenceBetweenCurrentAndHistory=()=>{if(this.characters.length!==this.history.data[this.history.index].characters.length)return!0;for(let e=0;e<this.characters.length;e+=1){if(this.characters[e].length!==this.history.data[this.history.index].characters[e].length)return!0;for(let t=0;t<this.characters[e].length;t+=1)if(this.characters[e][t]!==this.history.data[this.history.index].characters[e][t])return!0}return!1};dispatchEvents=()=>{const e={};if(null===this.getFocusedCharacter())e.left=null,e.top=null;else{const t=this.getFocusedCharacter().getBoundingClientRect(),i=this.editor.getBoundingClientRect();e.left=t.left-i.left,e.top=t.top-i.top}this.editor.dispatchEvent(new CustomEvent("custom-moveFocusPoint",{detail:{left:e.left,top:e.top}}));const t=this.textLines.length;t!==this.lastDispatchedEventValue.length&&(this.lastDispatchedEventValue.length=t,this.editor.dispatchEvent(new CustomEvent("custom-changeNumberOfTextLines",{detail:{length:this.lastDispatchedEventValue.length}})));const i=this.focusedRowIndex;i!==this.lastDispatchedEventValue.index&&(this.lastDispatchedEventValue.index=i,this.editor.dispatchEvent(new CustomEvent("custom-changeFocusedRowIndex",{detail:{index:this.lastDispatchedEventValue.index}})));const s=this.textArea.clientHeight/this.textArea.scrollHeight;s!==this.lastDispatchedEventValue.viewportHeightRatio&&(this.lastDispatchedEventValue.viewportHeightRatio=s,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaViewportHeightRatio",{detail:{viewportHeightRatio:this.lastDispatchedEventValue.viewportHeightRatio}})));const r=this.textArea.scrollTop;r!==this.lastDispatchedEventValue.scrollTop&&(this.lastDispatchedEventValue.scrollTop=r,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaScrollTop",{detail:{scrollTop:this.lastDispatchedEventValue.scrollTop}})));const o=this.textArea.clientWidth/this.textArea.scrollWidth;o!==this.lastDispatchedEventValue.viewportWidthRatio&&(this.lastDispatchedEventValue.viewportWidthRatio=o,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaViewportWidthRatio",{detail:{viewportWidthRatio:this.lastDispatchedEventValue.viewportWidthRatio}})));const a=this.textArea.scrollLeft;a!==this.lastDispatchedEventValue.scrollLeft&&(this.lastDispatchedEventValue.scrollLeft=a,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaScrollLeft",{detail:{scrollLeft:this.lastDispatchedEventValue.scrollLeft}})));const n=Boolean(this.selectionRange.length);n!==this.lastDispatchedEventValue.selecingRange&&(this.lastDispatchedEventValue.selecingRange=n,this.editor.dispatchEvent(new CustomEvent("custom-changeSelectingRange",{detail:{selectingRange:this.lastDispatchedEventValue.selecingRange}})))};getColumnsLastIndex=()=>this.characters[this.focusedRowIndex].length-1;getFocusedCharacter=()=>null===this.focusedRowIndex?null:this.characters[this.focusedRowIndex][this.focusedColumnIndex];getRowsLastIndex=()=>this.textLines.length-1;loadHistory=e=>{if(this.history.data[e]){this.textArea.textContent="";for(let t=0;t<this.history.data[e].textLines.length;t+=1){const i=this.history.data[e].textLines[t];i.textContent="";for(const s of this.history.data[e].characters[t])i.appendChild(s);this.textArea.appendChild(i)}this.characters=this.history.data[e].characters.map((e=>Array.from(e))),this.focusedColumnIndex=this.history.data[e].focusedColumnIndex,this.focusedRowIndex=this.history.data[e].focusedRowIndex,this.textArea.scrollLeft=this.history.data[e].scrollLeft,this.textArea.scrollTop=this.history.data[e].scrollTop,this.textLines=Array.from(this.history.data[e].textLines)}};moveFocusPointByArrowKey=(e,t)=>{if("ArrowDown"!==e){if("ArrowLeft"===e){if(0===this.focusedColumnIndex){if(0===this.focusedRowIndex)return;if(this.focusedRowIndex-=1,this.focusedColumnIndex=this.getColumnsLastIndex(),!t)return;return this.selectionRange.length?this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select")?(this.getFocusedCharacter().classList.remove("tom-editor__text-area__character--select"),this.selectionRange.pop(),void(this.selectionRange.length||(this.selectionRange=[]))):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.unshift([this.getFocusedCharacter()])):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([this.getFocusedCharacter()]))}if(this.focusedColumnIndex-=1,!t)return;return this.selectionRange.length?this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select")?(this.getFocusedCharacter().classList.remove("tom-editor__text-area__character--select"),this.selectionRange[this.selectionRange.length-1].pop(),void(this.selectionRange[0].length||1!==this.selectionRange.length||(this.selectionRange=[]))):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange[0].unshift(this.getFocusedCharacter())):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([this.getFocusedCharacter()]))}if("ArrowRight"===e){if(this.focusedColumnIndex===this.getColumnsLastIndex()){if(this.focusedRowIndex===this.getRowsLastIndex())return;if(this.focusedRowIndex+=1,this.focusedColumnIndex=0,!t)return;const e=this.characters[this.focusedRowIndex-1][this.characters[this.focusedRowIndex-1].length-1];return this.selectionRange.length?e.classList.contains("tom-editor__text-area__character--select")?(e.classList.remove("tom-editor__text-area__character--select"),this.selectionRange.shift(),void(this.selectionRange.length||(this.selectionRange=[]))):(e.classList.add("tom-editor__text-area__character--select"),this.selectionRange[this.selectionRange.length-1].push(e),void this.selectionRange.push([])):(e.classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([e]))}if(this.focusedColumnIndex+=1,!t)return;const e=this.characters[this.focusedRowIndex][this.focusedColumnIndex-1];return this.selectionRange.length?e.classList.contains("tom-editor__text-area__character--select")?(e.classList.remove("tom-editor__text-area__character--select"),this.selectionRange[0].shift(),void(this.selectionRange[0].length||(this.selectionRange=[]))):(e.classList.add("tom-editor__text-area__character--select"),void this.selectionRange[this.selectionRange.length-1].push(e)):(e.classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([e]))}if("ArrowUp"!==e)if("End"!==e){if("Home"!==e)throw new Error(`想定外の引数です（${e}）。`);for(let e=0;e<this.focusedColumnIndex;e+=1)this.moveFocusPointByArrowKey("ArrowUp",t)}else for(let e=0;e<this.getColumnsLastIndex()-this.focusedColumnIndex;e+=1)this.moveFocusPointByArrowKey("ArrowDown",t);else{const e=this.focusedRowIndex-1,i=this.focusedColumnIndex;for(;!(this.focusedRowIndex===e&&this.focusedColumnIndex===i||this.focusedRowIndex===e&&this.focusedColumnIndex<i||0===this.focusedRowIndex&&0===this.focusedColumnIndex);)this.moveFocusPointByArrowKey("ArrowLeft",t)}}else{const e=this.focusedRowIndex+1,i=this.focusedColumnIndex;for(;!(this.focusedRowIndex===e&&this.focusedColumnIndex===i||this.focusedRowIndex===e&&this.focusedColumnIndex<i||this.focusedRowIndex===this.getRowsLastIndex()&&this.focusedColumnIndex===this.getColumnsLastIndex());)this.moveFocusPointByArrowKey("ArrowRight",t)}};moveFocusPointByDragTarget=e=>{let t,i;if(e.classList.contains("tom-editor__text-area__character"))t=this.textLines.findIndex((t=>t===e.parentElement)),i=this.characters[t].findIndex((t=>t===e));else{if(!e.classList.contains("tom-editor__text-area__text-line"))return!1;t=this.textLines.findIndex((t=>t===e)),i=this.getColumnsLastIndex()}if(t===this.focusedRowIndex&&i===this.focusedColumnIndex)return!1;for(;t<this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowUp",!0);for(;t>this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowDown",!0);for(;i<this.focusedColumnIndex;)this.moveFocusPointByArrowKey("ArrowLeft",!0);for(;i>this.focusedColumnIndex;)this.moveFocusPointByArrowKey("ArrowRight",!0);return!0};moveFocusPointByMousedownTarget=e=>e.target.classList.contains("tom-editor__text-area__character")?(this.focusedRowIndex=this.textLines.findIndex((t=>t===e.path[1])),void(this.focusedColumnIndex=this.characters[this.focusedRowIndex].findIndex((t=>t===e.target)))):e.target.classList.contains("tom-editor__text-area__text-line")?(this.focusedRowIndex=this.textLines.findIndex((t=>t===e.target)),void(this.focusedColumnIndex=this.getColumnsLastIndex())):void 0;reflectKey=e=>new Promise((async t=>{if(e.detail.ctrlKey){if("a"===e.detail.key){this.selectionRange=this.characters.map((e=>Array.from(e))),this.selectionRange[this.selectionRange.length-1].pop();for(const e of this.selectionRange)for(const t of e)t.classList.add("tom-editor__text-area__character--select");return this.focusedRowIndex=this.getRowsLastIndex(),this.focusedColumnIndex=this.getColumnsLastIndex(),t(!0)}if("c"===e.detail.key){const e=this.convertSelectedRangeIntoText(!1);return await navigator.clipboard.writeText(e),t(!0)}if("v"===e.detail.key)return navigator.clipboard.readText?(await navigator.clipboard.readText().then((e=>{this.selectionRange.length&&this.removeCharactersInSelectionRange();for(const t of e)if("\r"!==t)if("\n"!==t)this.appendCharacter(t);else{const e=this.getColumnsLastIndex()-this.focusedColumnIndex;this.appendTextLine(this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,e))}})),t(!0)):(alert("【！ 申し訳ございません ！】\nお使いのブラウザではペースト機能は非対応となっております。\nペースト機能をご利用いただく場合は別のブラウザでお願いします。"),t(!1));if("x"===e.detail.key){const e=this.convertSelectedRangeIntoText(!0);return await navigator.clipboard.writeText(e),t(!0)}return"y"===e.detail.key?this.history.data[this.history.index+1]?(this.history.index+=1,this.loadHistory(this.history.index),t(!0)):t(!1):"z"===e.detail.key&&this.history.data[this.history.index-1]?(this.history.index-=1,this.loadHistory(this.history.index),t(!0)):t(!1)}if(1===e.detail.key.length)return this.selectionRange.length&&this.removeCharactersInSelectionRange(),this.appendCharacter(e.detail.key),t(!0);if(e.detail.key.includes("Arrow")||["End","Home"].includes(e.detail.key))return!e.detail.shiftKey&&this.selectionRange.length?this.unselctRange():this.moveFocusPointByArrowKey(e.detail.key,e.detail.shiftKey),t(!0);if(["Backspace","Delete"].includes(e.detail.key))return this.selectionRange.length?this.removeCharactersInSelectionRange():this.removeCharacter(e.detail.key),t(!0);if("Enter"===e.detail.key){!e.detail.shiftKey&&this.selectionRange.length&&this.removeCharactersInSelectionRange();const i=this.getColumnsLastIndex()-this.focusedColumnIndex;return this.appendTextLine(this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,i)),t(!0)}if("Tab"===e.detail.key){if(e.detail.shiftKey)return t(!1);this.selectionRange.length&&this.removeCharactersInSelectionRange();const i="    ";for(const e of i)this.appendCharacter(e);return t(!0)}return t(!1)}));removeCharacter=e=>{if("Backspace"===e){if(0===this.focusedColumnIndex){if(0===this.focusedRowIndex)return;return this.focusedRowIndex-=1,this.focusedColumnIndex=this.getColumnsLastIndex(),void this.removeTextLine()}return this.focusedColumnIndex-=1,void this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove()}if("Delete"!==e)throw new Error(`想定外の引数です（${e}）。`);if(this.focusedColumnIndex!==this.getColumnsLastIndex())this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove();else{if(this.focusedRowIndex===this.getRowsLastIndex())return;this.removeTextLine()}};removeCharactersInSelectionRange=()=>{let e=0;for(const t of this.selectionRange)e+=t.length;if(this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select"))for(let t=0;t<e;t+=1)this.removeCharacter("Delete");else for(let t=0;t<e;t+=1)this.removeCharacter("Backspace");this.selectionRange=[]};removeTextLine=()=>{const e=this.characters[this.focusedRowIndex+1].splice(0);for(const t of e.reverse())this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex+1,0,t),this.getFocusedCharacter().after(t);this.textLines.splice(this.focusedRowIndex+1,1)[0].remove(),this.characters.splice(this.focusedRowIndex+1,1),this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove()};saveHistory=()=>{void 0!==this.history?(this.history.data.splice(this.history.index+1),this.history.data.push({characters:this.characters.map((e=>Array.from(e))),focusedColumnIndex:this.focusedColumnIndex,focusedRowIndex:this.focusedRowIndex,scrollLeft:this.textArea.scrollLeft,scrollTop:this.textArea.scrollTop,textLines:Array.from(this.textLines)}),this.history.index+=1):this.history={data:[{characters:this.characters.map((e=>Array.from(e))),focusedColumnIndex:0,focusedRowIndex:0,scrollLeft:0,scrollTop:0,textLines:Array.from(this.textLines)}],index:0}};scrollAutomatically=()=>{const e=this.getFocusedCharacter().getBoundingClientRect(),t=this.textArea.getBoundingClientRect();e.top<t.top+.5*e.height?this.textArea.scrollTop-=t.top+.5*e.height-e.top:e.bottom>t.bottom-1.5*e.height&&(this.textArea.scrollTop+=e.bottom-(t.bottom-1.5*e.height)),e.left<t.left+1.5*e.width?this.textArea.scrollLeft-=t.left+1.5*e.width-e.left:e.right>t.right-2.5*e.width&&(this.textArea.scrollLeft+=e.right-(t.right-2.5*e.width))};setEventListeners=e=>{if(this.editor.addEventListener("custom-resizeTextAreaHeight",(()=>{this.dispatchEvents()})),this.editor.addEventListener("custom-resizeTextAreaWidth",(e=>{this.textArea.style.maxWidth=`${e.detail.width}px`,this.dispatchEvents()})),this.editor.addEventListener("custom-scrollHorizontally",(e=>{if(e.detail.hasOwnProperty("scrollSize"))this.textArea.scrollLeft+=e.detail.scrollSize;else{if(!e.detail.hasOwnProperty("scrollRatio"))return;this.textArea.scrollLeft+=e.detail.scrollRatio/this.textArea.clientWidth*this.textArea.scrollWidth}this.dispatchEvents()})),this.editor.addEventListener("custom-scrollVertically",(e=>{if(e.detail.hasOwnProperty("scrollSize"))this.textArea.scrollTop+=e.detail.scrollSize;else{if(!e.detail.hasOwnProperty("scrollRatio"))return;this.textArea.scrollTop+=e.detail.scrollRatio/this.textArea.clientHeight*this.textArea.scrollHeight}this.dispatchEvents()})),!e){const e={lastData:null,startColumnIndex:null,startSelectionStart:null};let t=!1,i=!1;this.textArea.addEventListener("mousedown",(e=>{i=!0,this.unselctRange(),this.moveFocusPointByMousedownTarget(e),this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-blur",(()=>{this.unselctRange(),this.focusedRowIndex=null,this.focusedColumnIndex=null,this.dispatchEvents()})),this.editor.addEventListener("custom-compositionend",(()=>{t=!1,e.lastData=null,e.startColumnIndex=null,e.startSelectionStart=null,this.differenceBetweenCurrentAndHistory()&&this.saveHistory()})),this.editor.addEventListener("custom-compositionstart",(()=>{t=!0,e.lastData="",e.startColumnIndex=this.focusedColumnIndex,e.startSelectionStart=null})),this.editor.addEventListener("custom-dragLineNumber",(e=>{for(;e.detail.index<this.focusedRowIndex-1;)this.moveFocusPointByArrowKey("ArrowUp",!0);for(;e.detail.index>this.focusedRowIndex-1&&(this.moveFocusPointByArrowKey("ArrowDown",!0),this.focusedRowIndex!==this.getRowsLastIndex()););this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-input",(i=>{if(t){if(null===e.startSelectionStart&&(e.startSelectionStart=i.detail.selectionStart-i.detail.data.length),i.detail.data!==e.lastData){this.focusedColumnIndex=e.startColumnIndex;for(let t=0;t<e.lastData.length;t+=1)this.removeCharacter("Delete");if(e.lastData=i.detail.data,null!==e.lastData)for(const t of e.lastData)this.appendCharacter(t)}this.focusedColumnIndex=e.startColumnIndex;for(let t=0;t<i.detail.selectionStart-e.startSelectionStart;t+=1)this.moveFocusPointByArrowKey("ArrowRight",!1);this.scrollAutomatically(),this.dispatchEvents()}})),this.editor.addEventListener("custom-keydown",(async e=>{t||await this.reflectKey(e)&&(this.scrollAutomatically(),this.differenceBetweenCurrentAndHistory()&&this.saveHistory(),this.dispatchEvents())})),this.editor.addEventListener("custom-mousedonwLineNumber",(e=>{this.unselctRange(),this.focusedRowIndex=e.detail.index,this.focusedColumnIndex=0,this.moveFocusPointByArrowKey("ArrowDown",!0),this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-mousemove",(e=>{i&&(this.moveFocusPointByDragTarget(e.detail.target),this.dispatchEvents())})),this.editor.addEventListener("custom-mouseup",(()=>{i=!1,this.dispatchEvents()}))}};unselctRange=()=>{for(const e of this.selectionRange)for(const t of e)t.classList.remove("tom-editor__text-area__character--select");this.selectionRange=[]}}(this.editor,s),this.virticalScrollbarArea=new class{constructor(e,t){Object.seal(this),this.editor=e,this.virticalScrollbarArea=this.createVirticalScrollbarArea(),e.appendChild(this.virticalScrollbarArea),this.virticalScrollbar=this.createVirticalScrollbar(),this.virticalScrollbarArea.appendChild(this.virticalScrollbar),this.setEventListeners(t)}CSSClass={virticalScrollbar:{element:"tom-editor__virtical-scrollbar-area__virtical-scrollbar"},virticalScrollbarArea:{element:"tom-editor__virtical-scrollbar-area",modifier:{active:"tom-editor__virtical-scrollbar-area__virtical-scrollbar--active"}}};editor;virticalScrollbar;virticalScrollbarArea;createVirticalScrollbar=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.virticalScrollbar.element),e};createVirticalScrollbarArea=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.virticalScrollbarArea.element),e};setEventListeners=e=>{const t=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let i,s,r=null;this.virticalScrollbar.addEventListener("mousedown",(e=>{r=e.y})),this.virticalScrollbarArea.addEventListener("mousedown",(e=>{if(e.target===this.virticalScrollbar)return;let i=t;e.y<this.virticalScrollbar.getBoundingClientRect().top&&(i*=-1),this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:i}}))})),this.editor.addEventListener("custom-changeTextAreaScrollTop",(e=>{i=e.detail.scrollTop,this.virticalScrollbar.classList.contains("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")&&(this.virticalScrollbar.style.top=s*i+"px")})),this.editor.addEventListener("custom-changeTextAreaViewportHeightRatio",(e=>{s=e.detail.viewportHeightRatio,1!==s?(this.virticalScrollbar.classList.add("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active"),this.virticalScrollbar.style.height=100*s+"%"):this.virticalScrollbar.classList.contains("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")&&this.virticalScrollbar.classList.remove("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")})),this.editor.addEventListener("custom-mousemove",(e=>{if(null===r)return;if(e.detail.y===r)return;const t=e.detail.y-r;r=e.detail.y,this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollRatio:t}}))})),this.editor.addEventListener("custom-mouseup",(()=>{r=null}))}}(this.editor,s);const o=this.textArea.textArea.getBoundingClientRect().left-this.editor.getBoundingClientRect().left;this.horizontalScrollbarArea=new class{constructor(e,t,i){Object.seal(this),this.editor=e,this.horizontalScrollbarArea=this.createHorizontalScrollbarArea(t),this.editor.appendChild(this.horizontalScrollbarArea),this.horizontalScrollbar=this.createHorizontalScrollbar(),this.horizontalScrollbarArea.appendChild(this.horizontalScrollbar),this.setEventListeners(i)}CSSClass={horizontalScrollbar:{element:"tom-editor__horizontal-scrollbar-area__horizontal-scrollbar"},horizontalScrollbarArea:{element:"tom-editor__horizontal-scrollbar-area",modifier:{active:"tom-editor__horizontal-scrollbar-area--active"}}};editor;horizontalScrollbar;horizontalScrollbarArea;createHorizontalScrollbar=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.horizontalScrollbar.element),e};createHorizontalScrollbarArea=e=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.horizontalScrollbarArea.element),t.style.left=`${e}px`,t};setEventListeners=e=>{const t=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let i,s,r=null;this.horizontalScrollbar.addEventListener("mousedown",(e=>{r=e.x})),this.horizontalScrollbarArea.addEventListener("mousedown",(e=>{if(e.target===this.horizontalScrollbar)return;let i=t;e.x<this.horizontalScrollbar.getBoundingClientRect().left&&(i*=-1),this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:i}}))})),this.editor.addEventListener("custom-changeTextAreaScrollLeft",(e=>{e.detail.scrollLeft!==i&&(i=e.detail.scrollLeft,this.horizontalScrollbar.style.left=s*i+"px")})),this.editor.addEventListener("custom-changeTextAreaViewportWidthRatio",(e=>{e.detail.viewportWidthRatio!==s&&(s=e.detail.viewportWidthRatio,1!==s?(this.horizontalScrollbarArea.classList.add(this.CSSClass.horizontalScrollbarArea.modifier.active),this.horizontalScrollbar.style.width=100*s+"%"):this.horizontalScrollbarArea.classList.contains(this.CSSClass.horizontalScrollbarArea.modifier.active)&&this.horizontalScrollbarArea.classList.remove(this.CSSClass.horizontalScrollbarArea.modifier.active))})),this.editor.addEventListener("custom-mousemove",(e=>{if(null===r)return;if(e.detail.x===r)return;const t=e.detail.x-r;r=e.detail.x,this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollRatio:t}}))})),this.editor.addEventListener("custom-mouseup",(()=>{r=null})),this.editor.addEventListener("custom-resizeTextAreaWidth",(e=>{this.horizontalScrollbarArea.style.width=`${e.detail.width}px`}))}}(this.editor,o,s),this.caret=new class{constructor(e,t){Object.seal(this),this.editor=e,this.caret=this.createCaret(),this.editor.appendChild(this.caret),this.setEventListeners(t)}caret;CSSClass={caret:{element:"tom-editor__caret",modifier:{active:"tom-editor__caret--active",focus:"tom-editor__caret--focus"}}};editor;createCaret=()=>{const e=document.createElement("textarea");return e.classList.add(this.CSSClass.caret.element),e};putCaret=(e,t)=>{this.caret.classList.add(this.CSSClass.caret.modifier.focus),this.caret.style.left=`${e}px`,this.caret.style.top=`${t}px`,this.caret.focus(),this.caret.classList.remove(this.CSSClass.caret.modifier.active),setTimeout((()=>{this.caret.classList.add(this.CSSClass.caret.modifier.active)}),50)};takeCaret=()=>{this.caret.classList.remove(this.CSSClass.caret.modifier.active,this.CSSClass.caret.modifier.focus)};setEventListeners=e=>{e||(this.caret.addEventListener("blur",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-blur"))})),this.caret.addEventListener("input",(e=>{this.editor.dispatchEvent(new CustomEvent("custom-input",{detail:{data:e.data,selectionStart:this.caret.selectionStart}}))})),this.caret.addEventListener("compositionend",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-compositionend"))})),this.caret.addEventListener("compositionstart",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-compositionstart"))})),this.caret.addEventListener("keydown",(e=>{e.preventDefault(),this.editor.dispatchEvent(new CustomEvent("custom-keydown",{detail:{ctrlKey:e.ctrlKey,key:e.key,shiftKey:e.shiftKey}}))})),this.editor.addEventListener("custom-moveFocusPoint",(e=>{null!==e.detail.left&&null!==e.detail.top?this.putCaret(e.detail.left,e.detail.top):this.takeCaret()})))}}(this.editor,s),this.decorationUnderline=new class{constructor(e,t,i){Object.seal(this),this.editor=e,this.decorationUnderline=this.createDecorationUnderline(t),this.editor.appendChild(this.decorationUnderline),this.setEventListeners(i)}CSSClass={decorationUnderline:{element:"tom-editor__decoration-underline",modifier:{active:"tom-editor__decoration-underline--active"}}};decorationUnderline;editor;lastFocusPointTop=null;lastSelectingRange=!1;adjustDecorationUnderlineStyle=()=>{null===this.lastFocusPointTop||this.lastSelectingRange?this.decorationUnderline.classList.contains(this.CSSClass.decorationUnderline.modifier.active)&&this.decorationUnderline.classList.remove(this.CSSClass.decorationUnderline.modifier.active):(this.decorationUnderline.classList.add(this.CSSClass.decorationUnderline.modifier.active),this.decorationUnderline.style.top=`${this.lastFocusPointTop}px`)};createDecorationUnderline=e=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.decorationUnderline.element),t.style.left=`${e}px`,t};setEventListeners=e=>{if(!e){const e=.5*parseFloat(getComputedStyle(this.editor).fontSize);this.editor.addEventListener("custom-changeSelectingRange",(e=>{this.lastSelectingRange=e.detail.selectingRange,this.adjustDecorationUnderlineStyle()})),this.editor.addEventListener("custom-moveFocusPoint",(e=>{this.lastFocusPointTop=e.detail.top,this.adjustDecorationUnderlineStyle()})),this.editor.addEventListener("custom-resizeTextAreaWidth",(t=>{this.decorationUnderline.style.width=t.detail.width-e+"px"}))}}}(this.editor,o,s),this.setEventListeners(this.lineNumberArea.lineNumberArea,this.virticalScrollbarArea.virticalScrollbarArea,this.horizontalScrollbarArea.horizontalScrollbarArea,s)}get value(){let e="";for(let t=0;t<this.textArea.characters.length;t+=1)for(let i=0;i<this.textArea.characters[t].length;i+=1){if(i===this.textArea.characters[t].length-1){if(t===this.textArea.characters.length-1)break;e+="\n";break}e+=this.textArea.characters[t][i].textContent}return e}set value(e){if("string"!=typeof e)throw new TypeError("第1引数がstring型ではありません。");this.textArea.characters=[],this.textArea.focusedColumnIndex=null,this.textArea.focusedRowIndex=null,this.textArea.selectionRange=[],this.textArea.textLines=[],this.textArea.textArea.textContent="";for(const t of e.split("\n")){const e=this.textArea.createTextLine();this.textArea.textLines.push(e),this.textArea.characters.push([]);for(const i of t){const t=this.textArea.createCharacter(i);this.textArea.characters[this.textArea.characters.length-1].push(t),e.appendChild(t)}const i=this.textArea.createEOL();this.textArea.characters[this.textArea.characters.length-1].push(i),e.appendChild(i),this.textArea.textArea.appendChild(e)}this.textArea.dispatchEvents()}set valueObserver(e){if("function"!=typeof e)throw new TypeError("第1引数がFunction型ではありません。");this.editor.addEventListener("custom-compositionend",(()=>{this.textArea.differenceBetweenCurrentAndHistory()&&e(this.value)})),new MutationObserver((()=>{this.textArea.isComposing||e(this.value)})).observe(this.textArea.textArea,{childList:!0,subtree:!0})}caret;CSSClass={editor:{element:"tom-editor__editor"},editorWrapper:{element:"tom-editor__editor-wrapper"}};decorationUnderline;editor;horizontalScrollbarArea;lineNumberArea;textArea;virticalScrollbarArea;createEditor=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.editor.element),e};createEditorWrapper=()=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.editorWrapper.element),e};setEventListeners=(e,t,i,s)=>{const r=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let o,a,n=null,l=null;new ResizeObserver((i=>{i[0].contentRect.height!==o&&(o=i[0].contentRect.height,this.editor.dispatchEvent(new CustomEvent("custom-resizeTextAreaHeight"))),i[0].contentRect.width!==a&&(a=i[0].contentRect.width,this.editor.dispatchEvent(new CustomEvent("custom-resizeTextAreaWidth",{detail:{width:a-e.offsetWidth-t.offsetWidth}})))})).observe(this.editor),this.editor.addEventListener("mousedown",(e=>{e.preventDefault()})),this.editor.addEventListener("mousemove",(e=>{this.editor.dispatchEvent(new CustomEvent("custom-mousemove",{detail:{target:e.target,x:e.x,y:e.y}}))})),this.editor.addEventListener("touchend",(()=>{n=null,l=null})),this.editor.addEventListener("touchmove",(e=>{null!==n&&(this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:e.touches[0].pageX-n}})),n=e.touches[0].pageX),null!==l&&(this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:e.touches[0].pageY-l}})),l=e.touches[0].pageY)})),this.editor.addEventListener("touchstart",(e=>{n=e.touches[0].pageX,l=e.touches[0].pageY})),this.editor.addEventListener("wheel",(e=>{const t=Math.sign(e.deltaY)*r,s=[];let o=e.target;for(;null!==o;)s.push(o),o=o.parentElement;s.includes(i)?this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:t}})):this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:t}}))})),window.addEventListener("mouseup",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-mouseup"))}))}}})();var r=s.r;export{r as TOMEditor};