var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{r:()=>s});const s=class{constructor(t,e,...s){if(void 0===t)throw new TypeError("第1引数が指定されていません。");if(!t instanceof Element)throw new TypeError("第1引数がElement型ではありません。");if(void 0!==e){if("object"!=typeof e)throw new TypeError("第2引数がObject型ではありません。");for(const t in e)if("readonly"!==t){if("readonly"!==t)throw new Error(`キー「${t}」はキー名として許可されていません。`)}else if("boolean"!=typeof e.readonly)throw new Error("キー「readonly」には真偽値を指定してください。")}if(s.length)throw new TypeError("引数の数が不正です。");let i;Object.seal(this),t.innerHTML="",i=void 0!==e&&e.readonly;const r=this.createEditorWrapper();t.appendChild(r),this.editor=this.createEditor(),r.appendChild(this.editor),this.lineNumberArea=new class{constructor(t,e){Object.seal(this),this.editor=t,this.lineNumberArea=this.createLineNumberArea(),this.editor.appendChild(this.lineNumberArea),this.appendLineNumber();const s=document.createElement("span");s.innerHTML="0",s.style.display="inline-block",this.lineNumberArea.appendChild(s);const i=s.clientWidth;s.remove();const r=parseFloat(getComputedStyle(this.lineNumbers[0]).paddingRight);this.lineNumberArea.style.flexBasis=`${4.5*i+r}px`,this.setEventListeners(e)}CSSClass={lineNumber:{element:"tom-editor__line-number-area__line-number",modifier:{focus:"tom-editor__line-number-area__line-number--focus"}},lineNumberArea:{element:"tom-editor__line-number-area"}};editor;focusedLineNumberIndex=null;lineNumberArea;lineNumbers=[];appendLineNumber=()=>{const t=this.createLineNumber();this.lineNumbers.push(t),this.lineNumberArea.appendChild(t)};changeFocusLineNumber=t=>{if(null===t){if(null===this.focusedLineNumberIndex)return;return this.lineNumbers[this.focusedLineNumberIndex].classList.contains(this.CSSClass.lineNumber.modifier.focus)&&this.lineNumbers[this.focusedLineNumberIndex].classList.remove(this.CSSClass.lineNumber.modifier.focus),void(this.focusedLineNumberIndex=null)}t!==this.focusedLineNumberIndex&&(null!==this.focusedLineNumberIndex&&this.lineNumbers[this.focusedLineNumberIndex]&&this.lineNumbers[this.focusedLineNumberIndex].classList.remove(this.CSSClass.lineNumber.modifier.focus),this.focusedLineNumberIndex=t,this.lineNumbers[this.focusedLineNumberIndex].classList.add(this.CSSClass.lineNumber.modifier.focus))};createLineNumber=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.lineNumber.element),t.innerHTML=this.lineNumbers.length+1,t};createLineNumberArea=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.lineNumberArea.element),t};removeLineNumber=()=>{this.lineNumbers.pop().remove()};setEventListeners=t=>{if(!t){let t=null;this.lineNumberArea.addEventListener("mousedown",(e=>{t=this.lineNumbers.findIndex((t=>t===e.target)),this.editor.dispatchEvent(new CustomEvent("custom-mousedonwLineNumber",{detail:{index:t}}))})),this.editor.addEventListener("custom-mousemove",(e=>{if(null===t)return;const s=this.lineNumbers.findIndex((t=>t===e.detail.target));s!==t&&(t=s,this.editor.dispatchEvent(new CustomEvent("custom-dragLineNumber",{detail:{index:t}})))})),this.editor.addEventListener("custom-mouseup",(()=>{t=null})),this.editor.addEventListener("custom-changeFocusedRowIndex",(t=>{this.changeFocusLineNumber(t.detail.index)}))}this.editor.addEventListener("custom-changeNumberOfTextLines",(t=>{for(;t.detail.length>this.lineNumbers.length;)this.appendLineNumber();for(;t.detail.length<this.lineNumbers.length;)this.removeLineNumber()})),this.editor.addEventListener("custom-changeTextAreaScrollTop",(t=>{this.lineNumberArea.scrollTop=t.detail.scrollTop}))}}(this.editor,i),this.textArea=new class{constructor(t,e){Object.seal(this),this.editor=t,this.textArea=this.createTextArea(),this.editor.appendChild(this.textArea);const s=this.createTextLine();this.textLines.push(s),this.textArea.appendChild(s),this.characters.push([]);const i=this.createEOL();this.characters[0].push(i),s.appendChild(i),this.lastDispatchedEventValue={index:this.focusedRowIndex,length:this.textLines.length,scrollLeft:this.textArea.scrollLeft,scrollTop:this.textArea.scrollTop,selecingRange:Boolean(this.selectionRange.length),viewportHeightRatio:this.textArea.clientHeight/this.textArea.scrollHeight,viewportWidthRatio:this.textArea.clientWidth/this.textArea.scrollWidth},this.saveHistory(),this.setEventListeners(e)}CSSClass={character:{element:"tom-editor__text-area__character",modifier:{EOL:"tom-editor__text-area__character--eol"}},textArea:{element:"tom-editor__text-area"},textLine:{element:"tom-editor__text-area__text-line"}};characters=[];editor;focusedColumnIndex=null;focusedRowIndex=null;history;lastDispatchedEventValue;selectionRange=[];textArea;textLines=[];appendCharacter=t=>{const e=this.createCharacter(t);this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,0,e),this.focusedColumnIndex+=1,this.getFocusedCharacter().before(e)};appendTextLine=t=>{const e=this.createTextLine();this.textLines.splice(this.focusedRowIndex+1,0,e),this.characters.splice(this.focusedRowIndex+1,0,[]);const s=this.createEOL();t.push(s);for(const s of t)e.appendChild(s),this.characters[this.focusedRowIndex+1].push(s);this.textLines[this.focusedRowIndex].after(e),this.focusedRowIndex+=1,this.focusedColumnIndex=0};convertSelectedRangeIntoText=t=>{let e="";if(this.selectionRange.length)for(const t of this.selectionRange)for(const s of t){if(s.classList.contains("tom-editor__text-area__character--eol")){e+="\n";break}e+=s.innerHTML}else e="";return t&&this.removeCharactersInSelectionRange(),e};createCharacter=t=>{const e=document.createElement("span");return e.classList.add(this.CSSClass.character.element),e.innerHTML=t,e};createEOL=()=>{const t=document.createElement("span");return t.classList.add(this.CSSClass.character.element,this.CSSClass.character.modifier.EOL),t.innerHTML=" ",t};createTextArea=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.textArea.element),t};createTextLine=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.textLine.element),t};differenceBetweenCurrentAndHistory=()=>{if(this.characters.length!==this.history.data[this.history.index].characters.length)return!0;for(let t=0;t<this.characters.length;t+=1){if(this.characters[t].length!==this.history.data[this.history.index].characters[t].length)return!0;for(let e=0;e<this.characters[t].length;e+=1)if(this.characters[t][e]!==this.history.data[this.history.index].characters[t][e])return!0}return!1};dispatchEvents=()=>{const t={};if(null===this.getFocusedCharacter())t.left=null,t.top=null;else{const e=this.getFocusedCharacter().getBoundingClientRect(),s=this.editor.getBoundingClientRect();t.left=e.left-s.left,t.top=e.top-s.top}this.editor.dispatchEvent(new CustomEvent("custom-moveFocusPoint",{detail:{left:t.left,top:t.top}}));const e=this.textLines.length;e!==this.lastDispatchedEventValue.length&&(this.lastDispatchedEventValue.length=e,this.editor.dispatchEvent(new CustomEvent("custom-changeNumberOfTextLines",{detail:{length:this.lastDispatchedEventValue.length}})));const s=this.focusedRowIndex;s!==this.lastDispatchedEventValue.index&&(this.lastDispatchedEventValue.index=s,this.editor.dispatchEvent(new CustomEvent("custom-changeFocusedRowIndex",{detail:{index:this.lastDispatchedEventValue.index}})));const i=this.textArea.clientHeight/this.textArea.scrollHeight;i!==this.lastDispatchedEventValue.viewportHeightRatio&&(this.lastDispatchedEventValue.viewportHeightRatio=i,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaViewportHeightRatio",{detail:{viewportHeightRatio:this.lastDispatchedEventValue.viewportHeightRatio}})));const r=this.textArea.scrollTop;r!==this.lastDispatchedEventValue.scrollTop&&(this.lastDispatchedEventValue.scrollTop=r,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaScrollTop",{detail:{scrollTop:this.lastDispatchedEventValue.scrollTop}})));const o=this.textArea.clientWidth/this.textArea.scrollWidth;o!==this.lastDispatchedEventValue.viewportWidthRatio&&(this.lastDispatchedEventValue.viewportWidthRatio=o,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaViewportWidthRatio",{detail:{viewportWidthRatio:this.lastDispatchedEventValue.viewportWidthRatio}})));const a=this.textArea.scrollLeft;a!==this.lastDispatchedEventValue.scrollLeft&&(this.lastDispatchedEventValue.scrollLeft=a,this.editor.dispatchEvent(new CustomEvent("custom-changeTextAreaScrollLeft",{detail:{scrollLeft:this.lastDispatchedEventValue.scrollLeft}})));const n=Boolean(this.selectionRange.length);n!==this.lastDispatchedEventValue.selecingRange&&(this.lastDispatchedEventValue.selecingRange=n,this.editor.dispatchEvent(new CustomEvent("custom-changeSelectingRange",{detail:{selectingRange:this.lastDispatchedEventValue.selecingRange}})))};getColumnsLastIndex=()=>this.characters[this.focusedRowIndex].length-1;getFocusedCharacter=()=>null===this.focusedRowIndex?null:this.characters[this.focusedRowIndex][this.focusedColumnIndex];getRowsLastIndex=()=>this.textLines.length-1;loadHistory=t=>{if(this.history.data[t]){this.textArea.innerHTML="";for(let e=0;e<this.history.data[t].textLines.length;e+=1){const s=this.history.data[t].textLines[e];s.innerHTML="";for(const i of this.history.data[t].characters[e])s.appendChild(i);this.textArea.appendChild(s)}this.characters=this.history.data[t].characters.map((t=>Array.from(t))),this.focusedColumnIndex=this.history.data[t].focusedColumnIndex,this.focusedRowIndex=this.history.data[t].focusedRowIndex,this.textArea.scrollLeft=this.history.data[t].scrollLeft,this.textArea.scrollTop=this.history.data[t].scrollTop,this.textLines=Array.from(this.history.data[t].textLines)}};moveFocusPointByArrowKey=(t,e)=>{if("ArrowDown"!==t){if("ArrowLeft"===t){if(0===this.focusedColumnIndex){if(0===this.focusedRowIndex)return;if(this.focusedRowIndex-=1,this.focusedColumnIndex=this.getColumnsLastIndex(),!e)return;return this.selectionRange.length?this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select")?(this.getFocusedCharacter().classList.remove("tom-editor__text-area__character--select"),this.selectionRange.pop(),void(this.selectionRange.length||(this.selectionRange=[]))):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.unshift([this.getFocusedCharacter()])):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([this.getFocusedCharacter()]))}if(this.focusedColumnIndex-=1,!e)return;return this.selectionRange.length?this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select")?(this.getFocusedCharacter().classList.remove("tom-editor__text-area__character--select"),this.selectionRange[this.selectionRange.length-1].pop(),void(this.selectionRange[0].length||1!==this.selectionRange.length||(this.selectionRange=[]))):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange[0].unshift(this.getFocusedCharacter())):(this.getFocusedCharacter().classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([this.getFocusedCharacter()]))}if("ArrowRight"===t){if(this.focusedColumnIndex===this.getColumnsLastIndex()){if(this.focusedRowIndex===this.getRowsLastIndex())return;if(this.focusedRowIndex+=1,this.focusedColumnIndex=0,!e)return;const t=this.characters[this.focusedRowIndex-1][this.characters[this.focusedRowIndex-1].length-1];return this.selectionRange.length?t.classList.contains("tom-editor__text-area__character--select")?(t.classList.remove("tom-editor__text-area__character--select"),this.selectionRange.shift(),void(this.selectionRange.length||(this.selectionRange=[]))):(t.classList.add("tom-editor__text-area__character--select"),this.selectionRange[this.selectionRange.length-1].push(t),void this.selectionRange.push([])):(t.classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([t]))}if(this.focusedColumnIndex+=1,!e)return;const t=this.characters[this.focusedRowIndex][this.focusedColumnIndex-1];return this.selectionRange.length?t.classList.contains("tom-editor__text-area__character--select")?(t.classList.remove("tom-editor__text-area__character--select"),this.selectionRange[0].shift(),void(this.selectionRange[0].length||(this.selectionRange=[]))):(t.classList.add("tom-editor__text-area__character--select"),void this.selectionRange[this.selectionRange.length-1].push(t)):(t.classList.add("tom-editor__text-area__character--select"),void this.selectionRange.push([t]))}if("ArrowUp"!==t)if("End"!==t){if("Home"!==t)throw new Error(`想定外の引数です（${t}）。`);for(let t=0;t<this.focusedColumnIndex;t+=1)this.moveFocusPointByArrowKey("ArrowUp",e)}else for(let t=0;t<this.getColumnsLastIndex()-this.focusedColumnIndex;t+=1)this.moveFocusPointByArrowKey("ArrowDown",e);else{const t=this.focusedRowIndex-1,s=this.focusedColumnIndex;for(;!(this.focusedRowIndex===t&&this.focusedColumnIndex===s||this.focusedRowIndex===t&&this.focusedColumnIndex<s||0===this.focusedRowIndex&&0===this.focusedColumnIndex);)this.moveFocusPointByArrowKey("ArrowLeft",e)}}else{const t=this.focusedRowIndex+1,s=this.focusedColumnIndex;for(;!(this.focusedRowIndex===t&&this.focusedColumnIndex===s||this.focusedRowIndex===t&&this.focusedColumnIndex<s||this.focusedRowIndex===this.getRowsLastIndex()&&this.focusedColumnIndex===this.getColumnsLastIndex());)this.moveFocusPointByArrowKey("ArrowRight",e)}};moveFocusPointByDragTarget=t=>{let e,s;if(t.classList.contains("tom-editor__text-area__character"))e=this.textLines.findIndex((e=>e===t.parentElement)),s=this.characters[e].findIndex((e=>e===t));else{if(!t.classList.contains("tom-editor__text-area__text-line"))return!1;e=this.textLines.findIndex((e=>e===t)),s=this.getColumnsLastIndex()}if(e===this.focusedRowIndex&&s===this.focusedColumnIndex)return!1;for(;e<this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowUp",!0);for(;e>this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowDown",!0);for(;s<this.focusedColumnIndex;)this.moveFocusPointByArrowKey("ArrowLeft",!0);for(;s>this.focusedColumnIndex;)this.moveFocusPointByArrowKey("ArrowRight",!0);return!0};moveFocusPointByMousedownTarget=t=>t.target.classList.contains("tom-editor__text-area__character")?(this.focusedRowIndex=this.textLines.findIndex((e=>e===t.path[1])),void(this.focusedColumnIndex=this.characters[this.focusedRowIndex].findIndex((e=>e===t.target)))):t.target.classList.contains("tom-editor__text-area__text-line")?(this.focusedRowIndex=this.textLines.findIndex((e=>e===t.target)),void(this.focusedColumnIndex=this.getColumnsLastIndex())):void 0;reflectKey=t=>new Promise((async e=>{if(t.detail.ctrlKey){if("a"===t.detail.key){this.selectionRange=this.characters.map((t=>Array.from(t))),this.selectionRange[this.selectionRange.length-1].pop();for(const t of this.selectionRange)for(const e of t)e.classList.add("tom-editor__text-area__character--select");return this.focusedRowIndex=this.getRowsLastIndex(),this.focusedColumnIndex=this.getColumnsLastIndex(),e(!0)}if("c"===t.detail.key){const t=this.convertSelectedRangeIntoText(!1);return await navigator.clipboard.writeText(t),e(!0)}if("v"===t.detail.key)return navigator.clipboard.readText?(await navigator.clipboard.readText().then((t=>{this.selectionRange.length&&this.removeCharactersInSelectionRange();for(const e of t)if("\r"!==e)if("\n"!==e)this.appendCharacter(e);else{const t=this.getColumnsLastIndex()-this.focusedColumnIndex;this.appendTextLine(this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,t))}})),e(!0)):(alert("【！ 申し訳ございません ！】\nお使いのブラウザではペースト機能は非対応となっております。\nペースト機能をご利用いただく場合は別のブラウザでお願いします。"),e(!1));if("x"===t.detail.key){const t=this.convertSelectedRangeIntoText(!0);return await navigator.clipboard.writeText(t),e(!0)}return"y"===t.detail.key?this.history.data[this.history.index+1]?(this.history.index+=1,this.loadHistory(this.history.index),e(!0)):e(!1):"z"===t.detail.key&&this.history.data[this.history.index-1]?(this.history.index-=1,this.loadHistory(this.history.index),e(!0)):e(!1)}if(1===t.detail.key.length)return this.selectionRange.length&&this.removeCharactersInSelectionRange(),this.appendCharacter(t.detail.key),e(!0);if(t.detail.key.includes("Arrow")||["End","Home"].includes(t.detail.key))return!t.detail.shiftKey&&this.selectionRange.length?this.unselctRange():this.moveFocusPointByArrowKey(t.detail.key,t.detail.shiftKey),e(!0);if(["Backspace","Delete"].includes(t.detail.key))return this.selectionRange.length?this.removeCharactersInSelectionRange():this.removeCharacter(t.detail.key),e(!0);if("Enter"===t.detail.key){!t.detail.shiftKey&&this.selectionRange.length&&this.removeCharactersInSelectionRange();const s=this.getColumnsLastIndex()-this.focusedColumnIndex;return this.appendTextLine(this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,s)),e(!0)}if("Tab"===t.detail.key){if(t.detail.shiftKey)return e(!1);this.selectionRange.length&&this.removeCharactersInSelectionRange();const s="    ";for(const t of s)this.appendCharacter(t);return e(!0)}return e(!1)}));removeCharacter=t=>{if("Backspace"===t){if(0===this.focusedColumnIndex){if(0===this.focusedRowIndex)return;return this.focusedRowIndex-=1,this.focusedColumnIndex=this.getColumnsLastIndex(),void this.removeTextLine()}return this.focusedColumnIndex-=1,void this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove()}if("Delete"!==t)throw new Error(`想定外の引数です（${t}）。`);if(this.focusedColumnIndex!==this.getColumnsLastIndex())this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove();else{if(this.focusedRowIndex===this.getRowsLastIndex())return;this.removeTextLine()}};removeCharactersInSelectionRange=()=>{let t=0;for(const e of this.selectionRange)t+=e.length;if(this.getFocusedCharacter().classList.contains("tom-editor__text-area__character--select"))for(let e=0;e<t;e+=1)this.removeCharacter("Delete");else for(let e=0;e<t;e+=1)this.removeCharacter("Backspace");this.selectionRange=[]};removeTextLine=()=>{const t=this.characters[this.focusedRowIndex+1].splice(0);for(const e of t.reverse())this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex+1,0,e),this.getFocusedCharacter().after(e);this.textLines.splice(this.focusedRowIndex+1,1)[0].remove(),this.characters.splice(this.focusedRowIndex+1,1),this.characters[this.focusedRowIndex].splice(this.focusedColumnIndex,1)[0].remove()};saveHistory=()=>{void 0!==this.history?(this.history.data.splice(this.history.index+1),this.history.data.push({characters:this.characters.map((t=>Array.from(t))),focusedColumnIndex:this.focusedColumnIndex,focusedRowIndex:this.focusedRowIndex,scrollLeft:this.textArea.scrollLeft,scrollTop:this.textArea.scrollTop,textLines:Array.from(this.textLines)}),this.history.index+=1):this.history={data:[{characters:this.characters.map((t=>Array.from(t))),focusedColumnIndex:0,focusedRowIndex:0,scrollLeft:0,scrollTop:0,textLines:Array.from(this.textLines)}],index:0}};scrollAutomatically=()=>{const t=this.getFocusedCharacter().getBoundingClientRect(),e=this.textArea.getBoundingClientRect();t.top<e.top+.5*t.height?this.textArea.scrollTop-=e.top+.5*t.height-t.top:t.bottom>e.bottom-1.5*t.height&&(this.textArea.scrollTop+=t.bottom-(e.bottom-1.5*t.height)),t.left<e.left+1.5*t.width?this.textArea.scrollLeft-=e.left+1.5*t.width-t.left:t.right>e.right-2.5*t.width&&(this.textArea.scrollLeft+=t.right-(e.right-2.5*t.width))};setEventListeners=t=>{if(!t){const t={lastData:null,startColumnIndex:null,startSelectionStart:null};let e=!1,s=!1;this.textArea.addEventListener("mousedown",(t=>{s=!0,this.unselctRange(),this.moveFocusPointByMousedownTarget(t),this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-blur",(()=>{this.unselctRange(),this.focusedRowIndex=null,this.focusedColumnIndex=null,this.dispatchEvents()})),this.editor.addEventListener("custom-compositionend",(()=>{e=!1,t.lastData=null,t.startColumnIndex=null,t.startSelectionStart=null,this.differenceBetweenCurrentAndHistory()&&this.saveHistory()})),this.editor.addEventListener("custom-compositionstart",(()=>{e=!0,t.lastData="",t.startColumnIndex=this.focusedColumnIndex,t.startSelectionStart=null})),this.editor.addEventListener("custom-dragLineNumber",(t=>{for(;t.detail.index<this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowUp",!0);for(;t.detail.index>this.focusedRowIndex;)this.moveFocusPointByArrowKey("ArrowDown",!0);this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-input",(s=>{if(e){if(null===t.startSelectionStart&&(t.startSelectionStart=s.detail.selectionStart-s.detail.data.length),s.detail.data!==t.lastData){this.focusedColumnIndex=t.startColumnIndex;for(let e=0;e<t.lastData.length;e+=1)this.removeCharacter("Delete");if(t.lastData=s.detail.data,null!==t.lastData)for(const e of t.lastData)this.appendCharacter(e)}this.focusedColumnIndex=t.startColumnIndex;for(let e=0;e<s.detail.selectionStart-t.startSelectionStart;e+=1)this.moveFocusPointByArrowKey("ArrowRight",!1);this.scrollAutomatically(),this.dispatchEvents()}})),this.editor.addEventListener("custom-keydown",(async t=>{e||await this.reflectKey(t)&&(this.scrollAutomatically(),this.differenceBetweenCurrentAndHistory()&&this.saveHistory(),this.dispatchEvents())})),this.editor.addEventListener("custom-mousedonwLineNumber",(t=>{this.unselctRange(),this.focusedRowIndex=t.detail.index,this.focusedColumnIndex=0,this.moveFocusPointByArrowKey("ArrowDown",!0),this.scrollAutomatically(),this.dispatchEvents()})),this.editor.addEventListener("custom-mousemove",(t=>{s&&(this.moveFocusPointByDragTarget(t.detail.target),this.dispatchEvents())})),this.editor.addEventListener("custom-mouseup",(()=>{s=!1,this.dispatchEvents()}))}this.editor.addEventListener("custom-resizeTextAreaHeight",(()=>{this.dispatchEvents()})),this.editor.addEventListener("custom-resizeTextAreaWidth",(t=>{this.textArea.style.maxWidth=`${t.detail.width}px`,this.dispatchEvents()})),this.editor.addEventListener("custom-scrollHorizontally",(t=>{this.textArea.scrollLeft+=t.detail.scrollSize/this.textArea.clientWidth*this.textArea.scrollWidth,this.dispatchEvents()})),this.editor.addEventListener("custom-scrollVertically",(t=>{this.textArea.scrollTop+=t.detail.scrollSize/this.textArea.clientHeight*this.textArea.scrollHeight,this.dispatchEvents()}))};unselctRange=()=>{for(const t of this.selectionRange)for(const e of t)e.classList.remove("tom-editor__text-area__character--select");this.selectionRange=[]}}(this.editor,i),this.virticalScrollbarArea=new class{constructor(t,e){Object.seal(this),this.editor=t,this.virticalScrollbarArea=this.createVirticalScrollbarArea(),t.appendChild(this.virticalScrollbarArea),this.virticalScrollbar=this.createVirticalScrollbar(),this.virticalScrollbarArea.appendChild(this.virticalScrollbar),this.setEventListeners(e)}CSSClass={virticalScrollbar:{element:"tom-editor__virtical-scrollbar-area__virtical-scrollbar"},virticalScrollbarArea:{element:"tom-editor__virtical-scrollbar-area",modifier:{active:"tom-editor__virtical-scrollbar-area__virtical-scrollbar--active"}}};editor;virticalScrollbar;virticalScrollbarArea;createVirticalScrollbar=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.virticalScrollbar.element),t};createVirticalScrollbarArea=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.virticalScrollbarArea.element),t};setEventListeners=t=>{const e=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let s,i,r=null;this.virticalScrollbar.addEventListener("mousedown",(t=>{r=t.y})),this.virticalScrollbarArea.addEventListener("mousedown",(t=>{if(t.target===this.virticalScrollbar)return;let s=e;t.y<this.virticalScrollbar.getBoundingClientRect().top&&(s*=-1),this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:s}}))})),this.editor.addEventListener("custom-changeTextAreaScrollTop",(t=>{s=t.detail.scrollTop,this.virticalScrollbar.classList.contains("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")&&(this.virticalScrollbar.style.top=i*s+"px")})),this.editor.addEventListener("custom-changeTextAreaViewportHeightRatio",(t=>{i=t.detail.viewportHeightRatio,1!==i?(this.virticalScrollbar.classList.add("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active"),this.virticalScrollbar.style.height=100*i+"%"):this.virticalScrollbar.classList.contains("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")&&this.virticalScrollbar.classList.remove("tom-editor__virtical-scrollbar-area__virtical-scrollbar--active")})),this.editor.addEventListener("custom-mousemove",(t=>{if(null===r)return;if(t.detail.y===r)return;const e=t.detail.y-r;r=t.detail.y,this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:e}}))})),this.editor.addEventListener("custom-mouseup",(()=>{r=null}))}}(this.editor,i);const o=this.textArea.textArea.getBoundingClientRect().left-this.editor.getBoundingClientRect().left;this.horizontalScrollbarArea=new class{constructor(t,e,s){Object.seal(this),this.editor=t,this.horizontalScrollbarArea=this.createHorizontalScrollbarArea(e),this.editor.appendChild(this.horizontalScrollbarArea),this.horizontalScrollbar=this.createHorizontalScrollbar(),this.horizontalScrollbarArea.appendChild(this.horizontalScrollbar),this.setEventListeners(s)}CSSClass={horizontalScrollbar:{element:"tom-editor__horizontal-scrollbar-area__horizontal-scrollbar"},horizontalScrollbarArea:{element:"tom-editor__horizontal-scrollbar-area",modifier:{active:"tom-editor__horizontal-scrollbar-area--active"}}};editor;horizontalScrollbar;horizontalScrollbarArea;createHorizontalScrollbar=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.horizontalScrollbar.element),t};createHorizontalScrollbarArea=t=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.horizontalScrollbarArea.element),e.style.left=`${t}px`,e};setEventListeners=t=>{const e=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let s,i,r=null;this.horizontalScrollbar.addEventListener("mousedown",(t=>{r=t.x})),this.horizontalScrollbarArea.addEventListener("mousedown",(t=>{if(t.target===this.horizontalScrollbar)return;let s=e;t.x<this.horizontalScrollbar.getBoundingClientRect().left&&(s*=-1),this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:s}}))})),this.editor.addEventListener("custom-changeTextAreaScrollLeft",(t=>{t.detail.scrollLeft!==s&&(s=t.detail.scrollLeft,this.horizontalScrollbar.style.left=i*s+"px")})),this.editor.addEventListener("custom-changeTextAreaViewportWidthRatio",(t=>{t.detail.viewportWidthRatio!==i&&(i=t.detail.viewportWidthRatio,1!==i?(this.horizontalScrollbarArea.classList.add(this.CSSClass.horizontalScrollbarArea.modifier.active),this.horizontalScrollbar.style.width=100*i+"%"):this.horizontalScrollbarArea.classList.contains(this.CSSClass.horizontalScrollbarArea.modifier.active)&&this.horizontalScrollbarArea.classList.remove(this.CSSClass.horizontalScrollbarArea.modifier.active))})),this.editor.addEventListener("custom-mousemove",(t=>{if(null===r)return;if(t.detail.x===r)return;const e=t.detail.x-r;r=t.detail.x,this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:e}}))})),this.editor.addEventListener("custom-mouseup",(()=>{r=null})),this.editor.addEventListener("custom-resizeTextAreaWidth",(t=>{this.horizontalScrollbarArea.style.width=`${t.detail.width}px`}))}}(this.editor,o,i),this.caret=new class{constructor(t,e){Object.seal(this),this.editor=t,this.caret=this.createCaret(),this.editor.appendChild(this.caret),this.setEventListeners(e)}caret;CSSClass={caret:{element:"tom-editor__caret",modifier:{active:"tom-editor__caret--active",focus:"tom-editor__caret--focus"}}};editor;createCaret=()=>{const t=document.createElement("textarea");return t.classList.add(this.CSSClass.caret.element),t};putCaret=(t,e)=>{this.caret.classList.add(this.CSSClass.caret.modifier.focus),this.caret.style.left=`${t}px`,this.caret.style.top=`${e}px`,this.caret.focus(),this.caret.classList.remove(this.CSSClass.caret.modifier.active),setTimeout((()=>{this.caret.classList.add(this.CSSClass.caret.modifier.active)}),50)};takeCaret=()=>{this.caret.classList.remove(this.CSSClass.caret.modifier.active,this.CSSClass.caret.modifier.focus)};setEventListeners=t=>{t||(this.caret.addEventListener("blur",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-blur"))})),this.caret.addEventListener("input",(t=>{this.editor.dispatchEvent(new CustomEvent("custom-input",{detail:{data:t.data,selectionStart:this.caret.selectionStart}}))})),this.caret.addEventListener("compositionend",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-compositionend"))})),this.caret.addEventListener("compositionstart",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-compositionstart"))})),this.caret.addEventListener("keydown",(t=>{t.preventDefault(),this.editor.dispatchEvent(new CustomEvent("custom-keydown",{detail:{ctrlKey:t.ctrlKey,key:t.key,shiftKey:t.shiftKey}}))})),this.editor.addEventListener("custom-moveFocusPoint",(t=>{null!==t.detail.left&&null!==t.detail.top?this.putCaret(t.detail.left,t.detail.top):this.takeCaret()})))}}(this.editor,i),this.decorationUnderline=new class{constructor(t,e,s){Object.seal(this),this.editor=t,this.decorationUnderline=this.createDecorationUnderline(e),this.editor.appendChild(this.decorationUnderline),this.setEventListeners(s)}CSSClass={decorationUnderline:{element:"tom-editor__decoration-underline",modifier:{active:"tom-editor__decoration-underline--active"}}};decorationUnderline;editor;lastFocusPointTop=null;lastSelectingRange=!1;adjustDecorationUnderlineStyle=()=>{null===this.lastFocusPointTop||this.lastSelectingRange?this.decorationUnderline.classList.contains(this.CSSClass.decorationUnderline.modifier.active)&&this.decorationUnderline.classList.remove(this.CSSClass.decorationUnderline.modifier.active):(this.decorationUnderline.classList.add(this.CSSClass.decorationUnderline.modifier.active),this.decorationUnderline.style.top=`${this.lastFocusPointTop}px`)};createDecorationUnderline=t=>{const e=document.createElement("div");return e.classList.add(this.CSSClass.decorationUnderline.element),e.style.left=`${t}px`,e};setEventListeners=t=>{if(!t){const t=.5*parseFloat(getComputedStyle(this.editor).fontSize);this.editor.addEventListener("custom-changeSelectingRange",(t=>{this.lastSelectingRange=t.detail.selectingRange,this.adjustDecorationUnderlineStyle()})),this.editor.addEventListener("custom-moveFocusPoint",(t=>{this.lastFocusPointTop=t.detail.top,this.adjustDecorationUnderlineStyle()})),this.editor.addEventListener("custom-resizeTextAreaWidth",(e=>{this.decorationUnderline.style.width=e.detail.width-t+"px"}))}}}(this.editor,o,i),this.setEventListeners(this.lineNumberArea.lineNumberArea,this.virticalScrollbarArea.virticalScrollbarArea,this.horizontalScrollbarArea.horizontalScrollbarArea,i)}get value(){let t="";for(let e=0;e<this.textArea.characters.length;e+=1)for(let s=0;s<this.textArea.characters[e].length;s+=1){if(s===this.textArea.characters[e].length-1){if(e===this.textArea.characters.length-1)break;t+="\n";break}t+=this.textArea.characters[e][s].innerHTML}return t}set value(t){if("string"!=typeof t)throw new TypeError("第1引数がstring型ではありません。");this.textArea.characters=[],this.textArea.focusedColumnIndex=null,this.textArea.focusedRowIndex=null,this.textArea.selectionRange=[],this.textArea.textLines=[],this.textArea.textArea.innerHTML="";for(const e of t.split("\n")){const t=this.textArea.createTextLine();this.textArea.textLines.push(t),this.textArea.characters.push([]);for(const s of e){const e=this.textArea.createCharacter(s);this.textArea.characters[this.textArea.characters.length-1].push(e),t.appendChild(e)}const s=this.textArea.createEOL();this.textArea.characters[this.textArea.characters.length-1].push(s),t.appendChild(s),this.textArea.textArea.appendChild(t)}this.textArea.dispatchEvents()}set valueObserver(t){if("function"!=typeof t)throw new TypeError("第1引数がFunction型ではありません。");this.editor.addEventListener("custom-compositionend",(()=>{this.textArea.tedifferenceBetweenCurrentAndHistory()&&t(this.value)})),new MutationObserver((()=>{this.textArea.isComposing||t(this.value)})).observe(this.textArea.textArea,{childList:!0,subtree:!0})}caret;CSSClass={editor:{element:"tom-editor__editor"},editorWrapper:{element:"tom-editor__editor-wrapper"}};decorationUnderline;editor;horizontalScrollbarArea;lineNumberArea;textArea;virticalScrollbarArea;createEditor=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.editor.element),t};createEditorWrapper=()=>{const t=document.createElement("div");return t.classList.add(this.CSSClass.editorWrapper.element),t};setEventListeners=(t,e,s,i)=>{const r=3.5*parseFloat(getComputedStyle(this.editor).lineHeight);let o,a,n=null,l=null;new ResizeObserver((s=>{s[0].contentRect.height!==o&&(o=s[0].contentRect.height,this.editor.dispatchEvent(new CustomEvent("custom-resizeTextAreaHeight"))),s[0].contentRect.width!==a&&(a=s[0].contentRect.width,this.editor.dispatchEvent(new CustomEvent("custom-resizeTextAreaWidth",{detail:{width:a-t.offsetWidth-e.offsetWidth}})))})).observe(this.editor),this.editor.addEventListener("mousedown",(t=>{t.preventDefault()})),this.editor.addEventListener("mousemove",(t=>{this.editor.dispatchEvent(new CustomEvent("custom-mousemove",{detail:{target:t.target,x:t.x,y:t.y}}))})),this.editor.addEventListener("touchend",(()=>{n=null,l=null})),this.editor.addEventListener("touchmove",(t=>{null!==n&&(this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:t.touches[0].pageX-n}})),n=t.touches[0].pageX),null!==l&&(this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:t.touches[0].pageY-l}})),l=t.touches[0].pageY)})),this.editor.addEventListener("touchstart",(t=>{n=t.touches[0].pageX,l=t.touches[0].pageY})),this.editor.addEventListener("wheel",(t=>{t.path.includes(s)?this.editor.dispatchEvent(new CustomEvent("custom-scrollHorizontally",{detail:{scrollSize:Math.sign(t.deltaY)*r}})):this.editor.dispatchEvent(new CustomEvent("custom-scrollVertically",{detail:{scrollSize:Math.sign(t.deltaY)*r}}))})),window.addEventListener("mouseup",(()=>{this.editor.dispatchEvent(new CustomEvent("custom-mouseup"))}))}};var i=e.r;export{i as TOMEditor};